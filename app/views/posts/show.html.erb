<% content_for(:title, @post.title) %>

<!-- OGP設定を追加 -->
<% content_for :og_title, @post.title %>
<% content_for :og_description, @post.body.truncate(80) if @post.body.present? %>
<% content_for :og_image, url_for(@post.image) if @post.image.attached? %>
<!-- ここまで -->

  <div class="max-w-3xl mx-auto px-4 py-8 flex flex-col w-full">

  <div class="w-full bg-white rounded-2xl shadow-lg border border-gray-200 p-6 flex flex-col space-y-6 mb-10">
    <!-- 画像部分 -->
    <div class="flex justify-center mb-6">
      <% if @post.image.attached? && @post.image.content_type.in?(%w[image/jpeg image/png]) %>
        <%= image_tag @post.image, class: "max-w-full max-h-[600px] object-contain rounded-lg shadow-lg" %>
      <% else %>
        <%= image_tag "place_holder.png", class: "w-full max-h-[400px] object-cover rounded-lg shadow border border-gray-300" %>
      <% end %>
    </div>

      <!-- タイトル -->
      <h1 class="text-3xl font-bold text-center mb-4">『 <%= @post.title %> 』</h1>

      <!-- 投稿者や日時 -->
      <div class="text-center text-sm text-gray-500 mt-6">
        投稿者：<%= @post.user.name if @post.user %>
        / 投稿日：<%= l @post.created_at %>
      </div>

      <!-- 本文 -->
      <div class="prose prose-lg mx-auto text-gray-800 whitespace-pre-line mb-12">
        <%= @post.body %>
      </div>

      <!-- サインインしているユーザーであれば表示 -->
      <%if logged_in? %>
        <!-- 編集・削除ボタン (自分の投稿であれば表示)-->
        <% if current_user&.own?(@post) %>
          <div class="flex justify-end space-x-4 mt-2">
            <div class="text-pink-600"><%= @post.emo_count %>回エモいボタンが押されました</div>
            <%= link_to edit_post_path(@post), id: "button-edit-#{@post.id}", class: "text-blue-600 hover:underline" do %>
              <%= image_tag "icon_pen.svg", alt: "edit", class: "w-6 h-6 mr-2" %>
            <% end %>
            <%= link_to post_path(@post), id: "button-delete-#{@post.id}", method: :delete, data: { turbo_method: :delete, turbo_confirm: t('defaults.delete_confirm') }, class: "text-red-600 hover:underline" do %>
              <%= image_tag "icon_trash.svg", alt: "delete", class: "w-6 h-6 mr-2" %>
            <% end %>
          </div>
        <% else %>
          <div class="flex items-center justify-between mt-4">
            <!-- エモリアクションボタン -->
            <div>
              <%= render 'emo_count', { post: @post } %>
            </div>
            <!-- ブクマボタン(他人の投稿であれば表示) -->
            <div>
              <%= render 'bookmark_buttons', { post: @post } %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="flex items-center">
          <div class="text-pink-500 font-semibold text-2xl drop-shadow-sm p-1">
            <%= @post.emo_count %>
          </div>
          <div class="text-pink-500 text-sm mr-2">
          <p>エモ</p>
          </div>
        </div>
      <% end %>
      <div class="mt-8 flex justify-center items-center">
        <% share_url = "https://twitter.com/intent/tweet?url=#{CGI.escape(request.original_url)}&text=#{CGI.escape(@post.title)}" %>
        <%= link_to share_url, target: "_blank", rel: "noopener noreferrer", class: "bg-sky-500 inline-block text-white px-4 py-2 rounded-lg" do %>
        Xでシェア
        <% end %>
      </div>
  </div>

  <!-- サインインしているユーザーであればフォーム表示 -->
  <%if logged_in? %>
    <!-- コメントフォーム -->
    <%= render 'comments/form', comment: @comment, post: @post %>
  <% end %>
  <!-- コメント一覧 -->
  <h3 class="text-lg font-semibold mb-4">コメント一覧</h3>
  <div id="table-comment">
    <%= render @comments %>
  </div>

  <!-- 戻るボタン -->
  <div class="flex justify-center mt-8">
    <%= link_to "一覧に戻る", posts_path, class: "bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition" %>
  </div>
</div>
